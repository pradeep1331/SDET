WITH grouped_data AS (
    SELECT 
        LOC_PAL.WHSE_ID,
        LOC_PAL.BLDG_ID,
        LOC_PAL.LOC_ID,
        PALLET_DTL.SKU,
        PALLET_DTL.LOT_NO1,
        PALLET_DTL.EXPIRY_DATE,
        PALLET_HOLD_DTL.HOLD_CD1,
        PALLET_DTL.ONHAND_QTY,
        COUNT(DISTINCT PALLET_DTL.SKU) OVER (PARTITION BY LOC_PAL.WHSE_ID, LOC_PAL.BLDG_ID, LOC_PAL.LOC_ID) AS SKU_COUNT
    FROM LOC_PAL
    JOIN PALLET_HDR ON LOC_PAL.WHSE_ID = PALLET_HDR.WHSE_ID AND LOC_PAL.BLDG_ID = PALLET_HDR.BLDG_ID AND LOC_PAL.PALLET_ID = PALLET_HDR.PALLET_ID
    JOIN PALLET_DTL ON LOC_PAL.WHSE_ID = PALLET_DTL.WHSE_ID AND LOC_PAL.BLDG_ID = PALLET_DTL.BLDG_ID AND LOC_PAL.PALLET_ID = PALLET_DTL.PALLET_ID
    LEFT JOIN PALLET_HOLD_DTL ON LOC_PAL.WHSE_ID = PALLET_HOLD_DTL.WHSE_ID AND LOC_PAL.BLDG_ID = PALLET_HOLD_DTL.BLDG_ID AND LOC_PAL.PALLET_ID = PALLET_HOLD_DTL.PALLET_ID
    WHERE LOC_PAL.WHSE_ID = 'your_desired_whse_id'
        AND LOC_PAL.BLDG_ID = 'your_desired_bldg_id'
        AND PALLET_DTL.ONHAND_QTY > 0
)
SELECT *
FROM grouped_data
WHERE SKU_COUNT > 1
